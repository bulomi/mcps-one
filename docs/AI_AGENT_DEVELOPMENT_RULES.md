# AI Agent 开发规则

> **文档目的**：本文档定义了AI Agent在开发MCP工具管理系统时必须遵守的规则、约束条件和最佳实践，确保开发过程的一致性、质量和安全性。

## 🎯 核心开发原则

### 1. 严格遵循需求文档
- **必须**：严格按照 `MVP_REQUIREMENTS.md` 中的优先级顺序开发（P0 → P1 → P2）
- **必须**：遵守所有标记为 `[CONSTRAINT]` 的约束条件
- **禁止**：偏离已定义的数据模型结构
- **禁止**：修改已确定的API接口规范
- **必须**：在实现前仔细阅读相关章节的完整内容

### 2. 代码质量标准
- **必须**：编写清晰、可读的代码，包含适当的注释
- **必须**：遵循项目的代码风格和命名规范
- **必须**：实现完整的错误处理和异常捕获
- **必须**：添加必要的输入验证和数据校验
- **禁止**：硬编码敏感信息（密钥、密码等）
- **必须**：使用环境变量管理配置信息

### 3. 安全性要求
- **必须**：实现双重权限验证（前端隐藏 + 后端验证）
- **必须**：对所有用户输入进行严格验证和清理
- **必须**：使用参数化查询防止SQL注入
- **必须**：实现适当的访问控制和权限检查
- **禁止**：在日志中记录敏感信息
- **必须**：对敏感数据进行加密存储

## 📋 开发流程规范

### 1. 功能实现顺序
```
1. 数据模型定义 → 2. API接口实现 → 3. 前端界面开发 → 4. 集成测试
```

### 2. 每个功能模块必须包含
- **后端API**：完整的CRUD操作和业务逻辑
- **前端界面**：响应式设计和用户交互
- **权限控制**：基于角色的访问控制
- **错误处理**：友好的错误提示和异常处理
- **数据验证**：输入验证和格式检查

### 3. 测试要求
- **必须**：为每个API端点编写单元测试
- **必须**：测试所有权限控制逻辑
- **必须**：验证数据验证规则的有效性
- **必须**：测试错误处理和边界情况
- **推荐**：编写端到端测试覆盖主要用户流程

## 🔧 技术实现规范

### 1. 数据库操作
- **必须**：使用ORM进行数据库操作
- **必须**：实现数据库事务管理
- **必须**：添加适当的数据库索引
- **必须**：实现软删除而非物理删除
- **必须**：记录数据变更的审计日志

### 2. API设计
- **必须**：遵循RESTful API设计原则
- **必须**：使用统一的响应格式（ApiResponse/PaginatedResponse）
- **必须**：实现适当的HTTP状态码
- **必须**：添加API文档和注释
- **必须**：实现请求限流和防护机制

### 3. 前端开发
- **必须**：实现响应式设计（移动端、平板、桌面）
- **必须**：使用组件化开发模式
- **必须**：实现状态管理（用户状态、工具状态等）
- **必须**：添加加载状态和错误提示
- **必须**：实现无障碍访问支持

## 🚫 严格禁止事项

### 1. 安全相关
- **禁止**：在代码中硬编码密钥、密码或敏感信息
- **禁止**：跳过权限验证或实现不完整的权限控制
- **禁止**：直接执行用户输入的代码或命令
- **禁止**：在生产环境中启用调试模式
- **禁止**：暴露内部系统信息给未授权用户

### 2. 代码质量
- **禁止**：提交未测试的代码
- **禁止**：使用已弃用的库或方法
- **禁止**：编写重复的代码而不进行抽象
- **禁止**：忽略编译器或linter的警告
- **禁止**：提交包含TODO或FIXME的代码到生产环境

### 3. 数据处理
- **禁止**：直接修改数据库而不通过应用程序
- **禁止**：在没有备份的情况下执行数据迁移
- **禁止**：忽略数据验证和清理
- **禁止**：在日志中记录用户密码或敏感数据

## ✅ 开发检查清单

### 功能完成前必须检查
- [ ] 是否遵循了需求文档中的所有约束条件
- [ ] 是否实现了完整的权限控制
- [ ] 是否添加了适当的错误处理
- [ ] 是否进行了输入验证和数据清理
- [ ] 是否编写了相应的测试用例
- [ ] 是否更新了相关文档
- [ ] 是否进行了代码审查
- [ ] 是否测试了所有用户角色的访问权限

### 代码提交前必须检查
- [ ] 代码是否通过了所有测试
- [ ] 是否遵循了代码风格规范
- [ ] 是否移除了调试代码和注释
- [ ] 是否更新了版本号和变更日志
- [ ] 是否检查了依赖项的安全性

## 📚 参考文档

- **主要需求**：`SINGLE_USER_MVP_REQUIREMENTS.md`
- **项目概述**：`README_SINGLE_USER.md`
- **开发计划**：`DEVELOPMENT_PLAN.md`
- **用户需求**：`USER_REQUIREMENTS.md`

## 🔄 持续改进

### 代码审查要点
1. **功能正确性**：是否按需求正确实现
2. **安全性**：是否存在安全漏洞
3. **性能**：是否存在性能问题
4. **可维护性**：代码是否易于理解和维护
5. **测试覆盖**：是否有足够的测试覆盖

### 质量指标
- **代码覆盖率**：≥ 80%
- **API响应时间**：≤ 200ms（95%请求）
- **错误率**：≤ 0.1%
- **安全扫描**：无高危漏洞
- **性能测试**：通过负载测试

---

> **重要提醒**：本规则文档是强制性的，所有AI Agent在开发过程中必须严格遵守。违反这些规则可能导致系统安全风险、功能缺陷或项目延期。如有疑问，请参考需求文档或寻求澄清。